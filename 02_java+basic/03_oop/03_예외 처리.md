# 03. 예외 처리

#java #oop #예외 #exception #checked-exception #unchecked-exception #try-catch #finally #throw #throws #custom-exception #stack-trace

---

https://github.com/notlikelion/250804_oop/tree/main/src/step3

## 자주 쓰는 키워드/개념 빠른 참조

- 계층: `Throwable` → `Error` / `Exception` → `RuntimeException` · 기타 체크 예외
- 체크 여부: Checked(컴파일러 강제 처리) / Unchecked(런타임, 선택적 처리)
- 구문: `try`–`catch`–`finally`, 멀티 `catch`, `throw`, `throws`

---

## 예외 개요 (Overview)

#예외 #exception #익셉션

- 실생활 비유: “안전장치”가 동작해 기계가 멈추는 순간 — 더 큰 고장을 막기 위해 흐름을 바꿉니다.
- CS 관점: 비정상 상황을 타입으로 모델링해 흐름 제어. 복구 가능 여부에 따라 처리 전략을 선택.

- 분류
  - Error: JVM/시스템 레벨 치명 오류(예: `OutOfMemoryError`). 보통 복구 불가.
  - Exception: 애플리케이션 레벨 문제.
- 체크 여부
  - Unchecked: `RuntimeException` 계열(예: `NullPointerException`). 선언 의무 X.
  - Checked: 그 외(예: `IOException`). 선언/처리 의무 O.

간단 예시

```java
public class Demo {
    public static void main(String[] args) {
        String s = null;
        try {
            System.out.println(s.length()); // NullPointerException
        } catch (NullPointerException e) {
            e.printStackTrace();            // 스택 트레이스 출력
        }
    }
}
```

---

## 예외 처리 구문 (Syntax)

#try-catch #finally #throw #throws

- try–catch

```java
try {
    // 예외가 발생할 수 있는 코드
} catch (IOException e) {               // 1개 처리
    System.err.println(e.getMessage());
} catch (SQLException e) {              // 다른 타입 별도 처리
    // ...
}
```

- 멀티 catch(Java 7+)

```java
try {
    // ...
} catch (IOException | SQLException e) { // 공통 처리
    // 로그 후 공통 복구
}
```

- finally(항상 실행 — 자원 해제)

```java
FileInputStream in = null;
try {
    in = new FileInputStream("a.txt");
    // 파일 사용
} catch (IOException e) {
    e.printStackTrace();
} finally {
    if (in != null) try { in.close(); } catch (IOException ignored) {}
}
```

- throw(명시적 발생) / throws(전파 선언)

```java
void setAge(int age) {
    if (age < 0) throw new IllegalArgumentException("Age < 0"); // throw
}

void load() throws IOException { // throws 선언
    try (FileInputStream in = new FileInputStream("a.txt")) { // TWR
        // ...
    }
}
```

- try-with-resources(TWR, Java 7+): `AutoCloseable` 자원을 자동으로 닫음.

---

## 사용자 정의 예외 (Custom Exceptions)

#custom-exception #커스텀-예외

- 실생활 비유: 우리 서비스에 맞춘 경고등을 추가.
- CS 관점: 도메인 의미를 타입으로 표현해 가독성/처리 분기 개선.

```java
class WarningException extends RuntimeException { }
class CustomException extends Exception {
    CustomException(String msg){ super(msg); }
}
```

---

## 예외 전파(Propagate)와 처리 전략

#throws #전파 #핸들링

- 전파: “나 말고 호출자가 처리해라” — 상위 계층(예: 컨트롤러, 프레임워크)에서 일괄 처리 가능.
- 직접 처리: 지금 컨텍스트에서 복구가 가능할 때 로컬에서 처리.

```java
// 상위로 전파
static void readFile() throws FileNotFoundException {
    new java.io.FileReader("file.txt");
}

public static void main(String[] args) {
    try {
        readFile();
    } catch (FileNotFoundException e) { // 여기서 결정적으로 처리
        System.err.println("파일 없음: " + e.getMessage());
    }
}
```

---

## return과 finally 주의점

#finally #return

- finally에서의 `return`은 결과를 “덮어쓰기” 하므로 사용을 지양.

```java
static int demo() {
    try {
        return 5;
    } catch (Exception e) {
        return 6;
    } finally {
        return 7; // 최종 반환은 7 — 일반적으로 권장하지 않음
    }
}
```

---

## 통합 예제

- 목표: 입력 검증 → 체크/언체크 예외 구분 → 전파/처리 → 로그 유지

```java
import java.util.Random;

// 도메인 전용 예외
class MinimalException extends Exception {
    MinimalException(String msg){ super(msg); }
}
class WrongMinimalException extends Exception {
    WrongMinimalException(String msg){ super(msg); }
}

// 값 선택 로직 — 실패 조건별로 명확한 예외 구분
static int chooseRandom(int minimum) throws WrongMinimalException, MinimalException {
    Random rd = new Random();
    if (minimum > 1000) {
        throw new WrongMinimalException("1000 이하로 입력해주세요");
    }
    int result = rd.nextInt(1000); // 0..999
    if (result < minimum) {
        throw new MinimalException("최소보다 작네요");
    }
    return result;
}

// 사용 측 — 복구/메시지 정책을 호출부에서 결정
public static void main(String[] args) {
    try {
        int value = chooseRandom(700);
        System.out.println("나온 값은 " + value + "입니다!");
    } catch (WrongMinimalException e) {
        System.err.println("요청 오류: " + e.getMessage());
    } catch (MinimalException e) {
        System.err.println("조건 미충족: " + e.getMessage());
    } catch (Exception e) {
        e.printStackTrace(); // 예기치 못한 오류는 스택 트레이스 보존
    }
}
```
